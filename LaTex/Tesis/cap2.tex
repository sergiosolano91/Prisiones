\chapter{Modelos SARIMA}

La estimación de los modelos se realiza usando el paquete base del software R \cite{RCoreTeam2017}, y el paquete astsa \cite{Stoffer2014}, cuyo uso es discutido en detalle por Shumway \cite{Shumway}. 

En adelante nos referiremos a la función de auctocorrelación como ACF y a la función de autocorrelación parcial como PACF. 

\section{Identificación del modelo}

% Variación población total, sindicada y condenada
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{variacion_intermensual}
	\caption[Variación inter-mensual de población carcelaria]{Variación inter-mensual de población carcelaria, sindicados y condenados}{Fuente: INPEC} {Elaboración propia}
	\label{fig:variacion_intermensual}
\end{figure}

Antes de realizar la proyección de una serie de tiempo, es necesario identificar el modelo que explique adecuadamente su comportamiento. 

Aunque conocemos, por la estructura del proceso que genera los datos, que las series de tiempo de población sindicada y condenada no son independientes, podemos simplificar la proyección, tratándolas como independientes. En este caso, los modelos ARIMA y SARIMA resultan apropiados, pues permiten explicar separadamente cada observación en función del comportamiento histórico de la serie.

El capítulo anterior sugería que la población carcelaria, tanto sindicada como condenada, tiene una marcada tendencia al alza. En este caso una herramienta útil es mostrar gráficamente la variación mes a mes de la población. \ref{fig:variacion_intermensual}. Para tener una mejor estrucutura de análisis usamos la función "decompose" de R base. 

La serie tiene un componente estacional marcado, con una reducción de la población carcelaria en diciembre. La variabilidad del componente aleatorio es elevada. La tendencia parece tener cambios estructurales en algunos periodos, por ejemplo reducción de la población carcelaria entre 2005-2007,  y 2012 - 2015, e incrementos de la población de magnitud mayor al promedio entre 2008 y 2012.

La mayor parte de la variación de la población total se puede asociar con variaciones en a población sindicada \ref{fig:variacion_mensual_sindicados_desc}. La población condenada tiene una tendencia con una tendencia más estable.  \ref{fig:variacion_mensual_condenados_desc}

% Descomposición variación población total
\begin{figure}[H]
\centering
\includegraphics[width=0.7\linewidth]{variacion_mensual_total_desc}
\caption[Descomposición de la variación inter-mensual de población carcelaria total]{Variación mensual de población carcelaria descompuesta por tendencia, estacionalidad y componente aleatorio.}{Fuente: INPEC} {Elaboración propia}
\label{fig:variacion_mensual_total_desc}
\end{figure}

% Descomposición variación población sindicada
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{variacion_mensual_sindicados_desc}
	\caption[Descomposición de la variación inter-mensual de población carcelaria total]{Variación mensual de población carcelaria sindicada,  descompuesta por tendencia, estacionalidad y componente aleatorio.}{Fuente: INPEC} {Elaboración propia}
	\label{fig:variacion_mensual_sindicados_desc}
\end{figure}

% Descomposición variación población condenada
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{variacion_mensual_condenados_desc}
	\caption[Descomposición de la variación inter-mensual de población carcelaria total]{Variación mensual de población carcelaria condenada,  descompuesta por tendencia, estacionalidad y componente aleatorio.}{Fuente: INPEC} {Elaboración propia}
	\label{fig:variacion_mensual_condenados_desc}
\end{figure}


Se trabaja sobre la diferencia de cada serie de tiempo con lag 1 y lag 12, al observar que la serie tiene un crecimiento sostenido entre 1991 y 2017, sugiriendo un proceso estocastico integrado. Sobre cada serie (población total, población sindicadda y población condenada)  se realiza la función de autocorrelación y autocorrelación parcial y se presenta en la figura \ref{fig:ACF_variacion_mensual}. Estas funciones son usadas como herramienta de diagnóstico, para identificar modelos adecuados en cada serie.

Con base en la tabla \ref{ARMA_ACF} se realiza una revisión del comportamiento de las series de población carcelaria, población sindicada y población condenada.

% Pendiente traducir este fragmento
\begin{table}[H]
	\centering
	\caption{Comportamiento de la ACF y PACF en modelos ARMA(p,q) \cite{Shumway}}
	\label{ARMA_ACF}
	\begin{tabular}{lllll}
		\multicolumn{1}{|l|}{}              & \multicolumn{1}{c|}{\textbf{AR(p)}}       & \multicolumn{1}{c|}{\textbf{MA(q)}}       & \multicolumn{1}{c|}{\textbf{ARMA(p,q)}} &  \\ \cline{1-4}
		\multicolumn{1}{|l|}{\textbf{ACF}}  & \multicolumn{1}{l|}{Tails off}            & \multicolumn{1}{l|}{Cuts off after lag q} & \multicolumn{1}{l|}{Tails off}          &  \\ \cline{1-4}
		\multicolumn{1}{|l|}{\textbf{PACF}} & \multicolumn{1}{l|}{Cuts off after lag p} & \multicolumn{1}{l|}{Tails off}            & \multicolumn{1}{l|}{Tails off}          &  \\ \cline{1-4}
	\end{tabular}
\end{table}


\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{ACF_var_pob-4.pdf}
	\caption[Autocorrelación parcial de la variación inter-mensual]{Autocorrelación parcial de la variación inter-mensual de la población}{Fuente: INPEC} {Elaboración propia}
	\label{fig:ACF_variacion_mensual}
\end{figure}

\subsection{Población total}

La tabla \ref{ARMA_ACF} presenta una guía para la interpretación de la ACF y la PACF. En la \ref{fig:ACF_variacion_mensual} podemos observar que tanto la ACF como la PACF decaen lentamente. La APCF decae progresivamente en los meses 12, 24, 36, mientra que la ACF se corta en el lag 24, lo que sugiere que el proceso es un promedio móvil de orden 1 en el componente estacional.

En este caso una primera estimación se realiza para la proyección de la población total como SARIMA(1,1,1,0,0,1)


\subsection{Población sindicada}

En la \ref{fig:ACF_variacion_mensual} podemos observar que la ACF decae lentamente, mientras la PACF cae por debajo del error luego del lag 1. La APCF decae progresivamente en los meses 12, 24, 36, mientra que la ACF se corta en el lag 12, lo que sugiere que el proceso es un promedio móvil de orden 1 en el componente estacional.

En este caso una primera estimación se realiza para la proyección de la población sindicada como SARIMA(1,1,1,0,0,1)

\subsection{Población condenada}

El comportamiento de la ACF y la PACF es similar al de la población sindicada, sugiriendo el mismo modelo: SARIMA(1,1,1,0,0,1).

\section{Estimación de parámtetros}

El proceso de estimación se realizará para cada serie por separado, luego se validará la efectividad de incluir más parámetros, usando como criterio de comparación el BIC. A modo informativo se usa la función auto.arima del paquete forecast, para seleccionar el modelo con menor AIC. \cite{Hyndman2017}  
 \cite{Hyndman2008}. 

\subsection{Población total}

De acuerdo con el diagnóstico se evaluaron los siguientes modelos: 

\begin{enumerate}
	\item Sarima de orden (1,1,1) y estacionalidad (0,0,2)
	\item Sarima de orden (1,1,1) y estacionalidad (0,0,1). Se valida que el BIC y el AIC son menores en el modelo 1, como se esperaría de acuerdo con nuestro diagnóstico. Ver tabla \ref{Compara_modelos_total}
	\item Sarima de orden (3,2,1) y estacionalidad (0,0,2). Es el modelo sugerido por la función auto.arima, sin embargo incluye parámetros autoregresivos no significativos (pvalue > 0.05). Ver tabla \ref{parámetros_321002}
	\item Sarima de orden (1,2,1) y estacionalidad (0,0,2). Este modelo tiene un BIC menor al modelo 3, y eliminando dos parámetros no significativos conserva un AIC cercano.
\end{enumerate}


Para el modelo 1 y el modelo 2 la estadística de Ljung-box sugiere que aún hay correlación significativa en los residuos, el modelo 3 y el modelo 4 no tienen correlación significativa en los residuos.

En las proyecciones siguientes para la población total se usará el modelo 4. 

\begin{table}[H]
	\centering
	\caption{Comparación de criterios de información}
	\label{Compara_modelos_total}
	\begin{tabular}{rlll}
		\hline
		& Orden & AIC & BIC \\ 
		\hline
		1 & (1,1,1)(0,0,2) & 4885.2 & 4907.66 \\ 
		2 & (1,1,1)(0,0,1) & 4897.79 & 4916.51 \\ 
		3 & (3,2,1)(0,0,2) & 4874.46 & 4900.64 \\ 
		4 & (1,2,1((0,0,2) & 4874.86 & 4893.56 \\ 
		\hline
	\end{tabular}
\end{table}

\begin{table}[H]
	\centering
	\caption{Parámetros del modelo (3,2,1,0,0,2)} 
	\label{parámetros_321002}
	\begin{tabular}{rrrrr}
		\hline
		& Estimate & SE & t.value & p.value \\ 
		\hline
		ar1 & 0.05 & 0.10 & 0.50 & 0.62 \\ 
		ar2 & -0.09 & 0.07 & -1.16 & 0.25 \\ 
		ar3 & -0.16 & 0.07 & -2.18 & 0.03 \\ 
		ma1 & -0.68 & 0.09 & -7.25 & 0.00 \\ 
		sma1 & 0.24 & 0.06 & 4.10 & 0.00 \\ 
		sma2 & 0.19 & 0.05 & 3.88 & 0.00 \\ 
		\hline
	\end{tabular}
\end{table}


\begin{table}[H]
	\centering
	\caption{Parámetros del modelo (1,2,1,0,0,2)}
	\label{parámetros_121002}
	\begin{tabular}{rrrrr}
		\hline
		& Estimate & SE & t.value & p.value \\ 
		\hline
		ar1 & 0.19 & 0.08 & 2.39 & 0.02 \\ 
		ma1 & -0.82 & 0.05 & -16.48 & 0.00 \\ 
		sma1 & 0.24 & 0.06 & 4.10 & 0.00 \\ 
		sma2 & 0.19 & 0.05 & 3.89 & 0.00 \\ 
		\hline
	\end{tabular}
\end{table}

%Gráficas de astsa sobre ajuste de modelos. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_total_111002}
	\caption[Diagnóstico del sarima (1,1,1)(0,0,2), población total]{Diagnóstico del Modelo 1. sarima (1,1,1)(0,0,2), para la población carcelaria total. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_total_111002}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_total_111001}
	\caption[Diagnóstico del sarima (1,1,1)(0,0,1), población total]{Diagnóstico del Modelo 2. sarima (1,1,1)(0,0,1), para la población carcelaria total. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_total_111001}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_total_321002}
	\caption[Diagnóstico del sarima (3,2,1)(0,0,2), población total]{Diagnóstico del Modelo 3. sarima (3,2,1)(0,0,2), para la población carcelaria total. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_total_321002}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_total_121002}
	\caption[Diagnóstico del sarima (1,2,1)(0,0,2), población total]{Diagnóstico del Modelo 4. sarima (1,2,1)(0,0,2), para la población carcelaria total. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_total_121002}
\end{figure}

\subsection{Población sindicada}


% latex table generated in R 3.4.2 by xtable 1.8-2 package
% Mon Oct 30 01:44:19 2017
\begin{table}[ht]
	\centering
		\caption{Comparación de criterios de información}
		\label{Compara_modelos_sindi}
	\begin{tabular}{rlll}
		\hline
		& ORDEN & AIC & BIC \\ 
		\hline
		1 & (1,1,1,0,0,1) & 4968.8 & 4987.52 \\ 
		2 & (2,1,1,0,0,1) & 4964.1 & 4986.56 \\ 
		3 & (0,1,1,0,0,1) & 4964.26 & 4982.98 \\ 
		4 & (0,1,1,0,0,0) & 4974.16 & 4985.39 \\ 
		\hline
	\end{tabular}
\end{table}

Modelo tres tiene el menor BIC y tiene pvalues for Ljung-Box que permiten descartar correlación. Ver tabla \ref{Compara_modelos_sindi}

% latex table generated in R 3.4.2 by xtable 1.8-2 package
% Mon Oct 30 01:50:26 2017
\begin{table}[H]
	\centering
		\caption{Parámetros del modelo (0,1,1,0,0,1)} 
		\label{parámetros_conde_011001}
	\begin{tabular}{rrrrr}
		\hline
		& Estimate & SE & t.value & p.value \\ 
		\hline
		ma1 & 0.06 & 0.06 & 0.99 & 0.32 \\ 
		ma2 & 0.16 & 0.05 & 2.91 & 0.00 \\ 
		sma1 & 0.15 & 0.06 & 2.57 & 0.01 \\ 
		constant & 64.94 & 53.21 & 1.22 & 0.22 \\ 
		\hline
	\end{tabular}
\end{table}


% Los criterios de información y los parámetros estimados difieren ligeramente entre paquetes

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_sindi_111001}
	\caption[Diagnóstico del sarima (1,1,1)(0,0,1), población sindicada]{Diagnóstico del Modelo 1. sarima (1,1,1)(0,0,1), para la población carcelaria sindicada. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_sindi_111001}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_sindi_211001}
	\caption[Diagnóstico del sarima (2,1,1)(0,0,1), población sindicada]{Diagnóstico del Modelo 2. sarima (1,1,1)(0,0,1), para la población carcelaria sindicada. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_sindi_211001}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_sindi_012001}
	\caption[Diagnóstico del sarima (0,1,2)(0,0,1), población sindicada]{Diagnóstico del Modelo 3. sarima (0,1,2)(0,0,1), para la población carcelaria sindicada. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_sindi_012001}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_sindi_011000}
	\caption[Diagnóstico del sarima (0,1,2)(0,0,0), población sindicada]{Diagnóstico del Modelo 4. sarima (0,1,1)(0,0,0), para la población carcelaria total. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_sindi_011000}
\end{figure}


\subsection{Población condenada}

%%%%%%%%%%%%

% latex table generated in R 3.4.2 by xtable 1.8-2 package
% Mon Oct 30 02:09:14 2017
\begin{table}[H]
	\centering
	\caption{Comparación de criterios de información}
	\label{Compara_modelos_conde}	
	\begin{tabular}{rlll}
		\hline
		& ORDEN & AIC & BIC \\ 
		\hline
		1 & (1,1,1,0,0,1) & 4904.08 & 4922.79 \\ 
		2 & (2,1,1,0,0,1) & 4906 & 4928.46 \\ 
		3 & (0,1,1,0,0,1) & 4914.84 & 4933.55 \\ 
		4 & (0,1,1,0,0,0) & 4925.62 & 4936.85 \\ 
		\hline
	\end{tabular}
\end{table}

%%%%%%%%%%%%%%%%

Se escoge el modelo 1, pues aunque tiene menos parsimonia, además los pvalue de la estadística de Ljung-Box soportan rechazar la hipótesis de dependencia.

Los modelos 3 y 4 se utilizan para comparar con el comportamiento de la población sindicada. En este caso, el comportamiento de la población condenada es diferente y es bien definido por el modelo 1 con los parámetros: 

\begin{table}[H]
	\centering
	\caption{Parámetros del modelo (1,1,1,0,0,1)} 
	\label{parámetros_conde_111001}
	\begin{tabular}{rrrrr}
		\hline
		& Estimate & SE & t.value & p.value \\ 
		\hline
		ar1 & 0.88 & 0.06 & 13.75 & 0.00 \\ 
		ma1 & -0.73 & 0.09 & -7.80 & 0.00 \\ 
		sma1 & 0.09 & 0.06 & 1.55 & 0.12 \\ 
		constant & 198.62 & 86.28 & 2.30 & 0.02 \\ 
		\hline
	\end{tabular}
	\caption{Parámetros del modelo (0,1,1,0,0,1)} 
	\label{parámetros_conde_011001}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Figuras diagnóstico condenados
%%%%%%%%%%%%%%%%%%%%%%%%%% 
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_conde_111001}
	\caption[Diagnóstico del sarima (1,1,1)(0,0,1), población condenada]{Diagnóstico del Modelo 1. sarima (1,1,1)(0,0,1), para la población carcelaria condenada. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_conde_111001}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_conde_211001}
	\caption[Diagnóstico del sarima (2,1,1)(0,0,1), población condenada]{Diagnóstico del Modelo 2. sarima (1,1,1)(0,0,1), para la población carcelaria condenada. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_conde_211001}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_conde_012001}
	\caption[Diagnóstico del sarima (0,1,2)(0,0,1), población condenada]{Diagnóstico del Modelo 3. sarima (0,1,2)(0,0,1), para la población carcelaria condenada. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_conde_012001}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Arima_conde_011000}
	\caption[Diagnóstico del sarima (0,1,2)(0,0,0), población condenada]{Diagnóstico del Modelo 4. sarima (0,1,1)(0,0,0), para la población carcelaria condenada. } {Fuente: INPEC} {Elaboración propia}
	\label{fig:Arima_conde_012000}
\end{figure}



\section{Proyección}

\subsection{Población total}

Proyección de la población total se presenta en la gráfica \ref{fig:pry_total_121002}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{graf_pry_total_4}
	\caption[Proyección de la población carcelaria total]{Proyección de la población carcelaria total, sarima (1,2,1,0,0,2)}
	\label{fig:pry_total_121002} {Fuente: INPEC} {Elaboración propia}
\end{figure}

\subsection{Población sindicada}

Proyección de la población total se presenta en la gráfica \ref{fig:pry_sindi_011001}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{graf_pry_sindi_3}
	\caption[Proyección de la población carcelaria sindicada]{Proyección de la población carcelaria sindicada, sarima (0,1,1,0,0,1)} {Fuente: INPEC} {Elaboración propia}
	\label{fig:pry_sindi_011001}
\end{figure}

\subsection{Población condenada}

Proyección de la población total se presenta en la gráfica \ref{fig:pry_conde_111001}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{graf_pry_conde_1}
	\caption[Proyección de la población carcelaria condenada]{Proyección de la población carcelaria condenada, sarima (1,1,1,0,0,1)} {Fuente: INPEC} {Elaboración propia}
	\label{fig:pry_conde_111001}
\end{figure}

\section{Conclusiones}

Al usar un ARIMA