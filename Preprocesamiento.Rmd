---
title: "La población carcelaria en Colombia 1991-2017"
author: "Sergio Solano"
date: "Febrero de 2016"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
autoloads <- c("dplyr", "ggplot2", "Hmisc")
options(defaultPackages = c(getOption("defaultPackages"), autoloads))
```

## Data 

El INPEC publica mensualemente la serie población carcelaria, desde 1991 hasta el mese anterior a la publicación. Esta serie se encuentra separada por situación jurídica (condenados, sindicados) y por genero. 

### Objetivo

El proceso a través del cual las personas pasan de una situación jurídica a otra es conocido, y sin embargo no observado, pues no se publican las series de tiempo que reflejan esta transición (cantidad de personas sentenciadas por mes, cantidad de personas liberadas mes, duración de la condena). 

Este ejercicio de demografía, enmarcado en el estudio de poblaciones pequeñas, presenta la oportunidad de comparar la efectividad de diferentes métodos de proyección.

### Análisis exploratorio

La población carcelaria total entre 1991 y 2017 se ha cuadruplicado, al pasar de 32.036 a 128.125 internos. Aunque la mayoría son hombres la población carcelaria feminina en el mismo periodo ha crecido a una tasa mayor, pues se ha multiplicado por cinco, de 1633 en 1991 a 7800 en 2017.

```{r librerías, echo = FALSE, include=FALSE }
rm(list = ls())
library("magrittr")
library("tidyr")
library("reshape2")
library("ggplot2")
library("plotly")
library("zoo")
library("shiny")
library("curl")
# library ("timeSeries")
library ("ggplot2")
library("dplyr")

```

```{r carga de datos, echo = FALSE, include=FALSE }
# Carga de archivos base
url <- "https://www.dropbox.com/s/epb2srm6pglyz9w/PPL_SITJUR_ENE17.csv?dl=1"
destfile <- "POB_SITJUR_INP_ENE17.csv"
curl_download(url, destfile)
data = read.csv("POB_SITJUR_INP_ENE17.csv",header = TRUE,sep = ",",stringsAsFactors=FALSE)

```


```{r forma de los datos, echo = FALSE, include=FALSE }

# Carga de archivos base Situación judicial
ppl_sitjur_ene17 <- (data[2:13,2:dim(data)[2]])
ppl_sitjur <- cbind(gather(ppl_sitjur_ene17)[2],rep(c(rep("sindicados",12), rep("condenados",12), rep("total",12)),dim(ppl_sitjur_ene17)[2]/3))
colnames(ppl_sitjur) <- c("valor", "categoria")
ppl_sitjur$valor <- as.numeric(ppl_sitjur$valor)*1000
anio <- sort(rep(seq(1991,1991+dim(ppl_sitjur_ene17)[2]/3-1,by =1),36))
mes <- rep(seq(1,12,1),dim(ppl_sitjur_ene17)[2])
ppl_sitjur <- cbind(ppl_sitjur,anio, mes) 
# ppl_sitjur  %<>% spread(key = "categoria", value = valor) 

ppl_sitjur %<>% mutate (fecha = as.Date(paste (1,mes,anio, sep = "/"),"%d/%m/%Y")) 
```


```{r gráfica de situación jurídica, echo = FALSE}

ppl_sitjur %>% filter (categoria %in% c("sindicados","condenados","total"), valor >0) %>%  ggplot() + geom_line(aes(x=fecha,y = valor, colour = categoria),stat = "identity") + ylab("Personas privadas de la libertad")-> grafica 
# ggplotly(grafica)
grafica

```


```{r carga de datos - genero, echo = FALSE, include=FALSE }
# Carga de archivos base
url <- "https://www.dropbox.com/s/95m8oziipdy6ely/PPL_GEN_ENE17.csv?dl=1"
destfile <- "POB_GEN_INP_ENE17.csv"
curl_download(url, destfile)
data = read.csv("POB_GEN_INP_ENE17.csv",header = TRUE,sep = ",",stringsAsFactors=FALSE)

```


```{r forma de los datos - genero, echo = FALSE, include=FALSE }

# Carga de archivos base Situación judicial
ppl_gen_ene17 <- (data[2:13,2:dim(data)[2]])
ppl_gen <- cbind(gather(ppl_gen_ene17)[2],rep(c(rep("hombres",12), rep("mujeres",12), rep("total",12)),dim(ppl_sitjur_ene17)[2]/3))
colnames(ppl_gen) <- c("valor", "categoria")
ppl_gen$valor <- as.numeric(ppl_gen$valor)*1000
anio <- sort(rep(seq(1991,1991+dim(ppl_sitjur_ene17)[2]/3-1,by =1),36))
mes <- rep(seq(1,12,1),dim(ppl_sitjur_ene17)[2])
ppl_gen <- cbind(ppl_gen,anio, mes) 
# ppl_sitjur  %<>% spread(key = "categoria", value = valor) 

ppl_gen %<>% mutate (fecha = as.Date(paste (1,mes,anio, sep = "/"),"%d/%m/%Y")) 
```


```{r grafica - genero, echo = FALSE}

ppl_gen %>% filter (categoria %in% c("hombres","mujeres","total"), valor >0) %>%  ggplot() + geom_line(aes(x=fecha,y = valor, colour = categoria),stat = "identity") + ylab("Personas privadas de la libertad")-> grafica 
# ggplotly(grafica)
 grafica
```



```{r, echo=FALSE, include = FALSE}
# setwd("/home/sergio/Prisiones") 
# rm(list=ls())
data = read.csv("POB_SIT.csv",header = FALSE,sep = ",",stringsAsFactors=FALSE)
 
POB = as.integer(c(unlist(data[2:13,2:dim(data)[2]])))
 
SIN = c(rep(c(rep(0,12),rep(1,12),rep(2,12)),900/36))
 
POB_SIN = cbind(POB,SIN)
 
SIND = subset(POB_SIN,POB_SIN[,"SIN"]==0)
 
 
MPP1 = subset(POB_SIN,POB_SIN[,"SIN"]==0)
MPP = MPP1[76:296,"POB"]

##### SERIES DE TIEMPO
#MPP = Male Prison Population

MPPtimeseries <- ts(MPP, frequency=12, start=c(1991,1))

logMMPtimeseries <- log(MPPtimeseries)

plot.ts(diff(logMMPtimeseries))
DeltaMPP = decompose(diff(logMMPtimeseries))
plot(DeltaMPP) 

# ggplot(DeltaMPP)

write.csv(DeltaMPP$trend, file = 'sindicados.txt', row.names = TRUE)

# Crecimiento promedio
mean(DeltaMPP$trend,na.rm = TRUE)*100

####### CONDENADOS 
MPP1 = subset(POB_SIN,POB_SIN[,"SIN"]==1)
MPP = MPP1[76:296,"POB"]

##### SERIES DE TIEMPO
#MPP = Male Prison Population

MPPtimeseries <- ts(MPP, frequency=12, start=c(1991,1))

logMMPtimeseries <- log(MPPtimeseries)

plot.ts(diff(logMMPtimeseries))

#ggplot(yt.views, aes(Date, Views)) + geom_line() +
#  scale_x_date(format = "%b-%Y") + xlab("") + ylab("Daily Views")




DeltaMPP = decompose(diff(logMMPtimeseries))
plot(DeltaMPP) 
# ggplot(DeltaMPP)
write.csv(DeltaMPP$trend, file = 'condenados.txt', row.names = TRUE)

# Crecimiento promedio
mean(DeltaMPP$trend,na.rm = TRUE)*100

####### TOTAL 
MPP1 = subset(POB_SIN,POB_SIN[,"SIN"]==2)
MPP = MPP1[76:296,"POB"]

##### SERIES DE TIEMPO
#MPP = Male Prison Population

MPPtimeseries <- ts(MPP, frequency=12, start=c(1991,1))

logMMPtimeseries <- log(MPPtimeseries)

plot.ts(diff(logMMPtimeseries))
DeltaMPP = decompose(diff(logMMPtimeseries))
plot(DeltaMPP) 
# ggplot(DeltaMPP)
write.csv(DeltaMPP$trend, file = 'condenados.txt', row.names = TRUE)

# Crecimiento promedio
mean(DeltaMPP$trend,na.rm = TRUE)*100


```

