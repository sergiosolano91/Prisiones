grafica
ggsave("genero.png")
url <- "https://www.dropbox.com/s/54vmiq6tfhor0t1/POB_NAL_DANE.csv?dl=1"
destfile <- "POB_NAL_DAN.csv"
curl_download(url, destfile)
# setwd("/home/sergio/Prisiones")
data = read.csv("POB_NAL_DAN.csv",header = TRUE,sep = ",",stringsAsFactors=FALSE)
# reordenar columnas por sexo
data %>% spread(Grupo, Total, fill = NA, convert = FALSE) %>% mutate(tasa_hombres = c(log(Hombres[2:length(Hombres)]/Hombres[1:length(Hombres)-1]),1))%>% mutate(tasa_mujeres = c(log(Mujeres[2:length(Mujeres)]/Mujeres[1:length(Mujeres)-1]),1))%>% mutate(Fecha=as.Date(paste("01","06",Año,sep="/"),"%d/%m/%Y"))   -> data2
# Proyectar población a nivel mensual
ts_pob_nal_hom <- zoo(data2$Hombres,data2$Fecha)
ts_pob_nal_hom_mon <- na.spline(ts_pob_nal_hom, xout = seq(start(ts_pob_nal_hom),as.Date(as.yearqtr(end(ts_pob_nal_hom))+ 3/4) , by = "month"), method = "hyman")
ts_pob_nal_muj <- zoo(data2$Mujeres,data2$Fecha)
ts_pob_nal_muj_mon <- na.spline(ts_pob_nal_muj, xout = seq(start(ts_pob_nal_muj),as.Date(as.yearqtr(end(ts_pob_nal_muj))+ 3/4) , by = "month"), method = "fmm")
pob_nal_est <- cbind(seq(as.Date("1985/6/1"), as.Date("2021/1/1"), "months"), as.data.frame.ts(ts_pob_nal_hom_mon),as.data.frame.ts(ts_pob_nal_muj_mon))
colnames(pob_nal_est) <- c("Fecha","hombres_nac","mujeres_nac")
pob_nal_est %<>% mutate (total_nac = hombres_nac + mujeres_nac)
ppl_gen  %<>% spread(key = "categoria", value = valor)
ppl_tasa <- left_join(pob_nal_est,ppl_gen, by = "Fecha") %>% mutate (tasa_hombres = hombres/hombres_nac * 100000, tasa_mujeres = mujeres/mujeres_nac * 100000, tasa_total = total/total_nac*100000)
ppl_tasa %>% ggplot() + geom_line(aes(x=Fecha,y=tasa_hombres,colour="Hombres")) +geom_line(aes(x=Fecha,y=tasa_mujeres,colour="Mujeres"))+geom_line(aes(x=Fecha,y=tasa_total,colour="Total")) + expand_limits(y=0) + ylab("Tasa de encarcelamiento")-> tasas_encarcelamiento
# ggplotly (tasas_encarcelamiento)
tasas_encarcelamiento
ggsave("tasas.png")
ppl_tasa %>% ggplot() + geom_line(aes(x=Fecha,y=tasa_hombres,colour="Hombres")) +geom_line(aes(x=Fecha,y=tasa_mujeres,colour="Mujeres"))+geom_line(aes(x=Fecha,y=tasa_total,colour="Total")) + expand_limits(y=0) + scale_y_log10 (breaks = c(10,50,100,200,400)) + ylab("Tasa de encarcelamiento")-> tasas_encarcelamiento_log
# ggplotly (tasas_encarcelamiento_log)
tasas_encarcelamiento_log
ggsave("tasas_log.png")
# ajustar población sindicada y condenada para análisis
MPPtimeseries <- ts(ppl_gen$total, frequency=12, start=c(1991,1))
autoplot(as.zoo(diff(log(MPPtimeseries))), geom = "line") + ylab("tasa de crecimiento- PPL total") + xlab("Periodo") -> graf_crecimiento
graf_crecimiento
# ggplotly(graf_crecimiento)
DeltaMPP <- decompose(diff(MPPtimeseries))
tendencia <- as.zoo(DeltaMPP$trend)
aleatorio <- as.zoo(DeltaMPP$random)
estacional <- as.zoo(DeltaMPP$seasonal)
autoplot(merge(tendencia,estacional, aleatorio), geom = "line") + ylab("tasa de crecimiento - descomposición") + xlab("Periodo") -> graf_tendencia
graf_tendencia
# ggplotly(graf_tendencia)
ggsave("desc_total.png")
MPPtimeseries <- ts(ppl_gen$total, frequency=12, start=c(1991,1))
autoplot(as.zoo(diff(log(MPPtimeseries))), geom = "line") + ylab("tasa de crecimiento- PPL total") + xlab("Periodo") -> graf_crecimiento
graf_crecimiento
# ggplotly(graf_crecimiento)
MPPtimeseries <- ts(ppl_gen$hombres, frequency=12, start=c(1991,1))
autoplot(as.zoo(diff(log(MPPtimeseries))), geom = "line") + ylab("tasa de crecimiento- PPL masculina") + xlab("Periodo") + theme(aspect.ratio=1/2) -> graf_crecimiento
graf_crecimiento
ggsave("crec_masc.png")
# ggplotly(graf_crecimiento)
DeltaMPP <- decompose(diff(log(MPPtimeseries)))
tendencia <- as.zoo(DeltaMPP$trend)
aleatorio <- as.zoo(DeltaMPP$random)
estacional <- as.zoo(DeltaMPP$seasonal)
autoplot(merge(tendencia,estacional, aleatorio), geom = "line") + ylab("tasa de crecimiento masculina- descomposición") + xlab("Periodo") -> graf_tendencia
graf_tendencia
ggsave("tend_masc_desc.png")
# ggplotly(graf_tendencia)
MPPtimeseries <- ts(ppl_gen$mujeres, frequency=12, start=c(1991,1))
autoplot(as.zoo(diff(log(MPPtimeseries))), geom = "line") + ylab("tasa de crecimiento- PPL femenina") + xlab("Periodo") + theme(aspect.ratio=1/2) -> graf_crecimiento
graf_crecimiento
ggsave("tasa_crec_femenina.png")
# ggplotly(graf_crecimiento)
DeltaMPP <- decompose(diff(log(MPPtimeseries)))
tendencia <- as.zoo(DeltaMPP$trend)
aleatorio <- as.zoo(DeltaMPP$random)
estacional <- as.zoo(DeltaMPP$seasonal)
autoplot(merge(tendencia,estacional, aleatorio), geom = "line") + ylab("tasa de crecimiento - descomposición") + xlab("Periodo") -> graf_tendencia
graf_tendencia
# ggplotly(graf_tendencia)
ggsave("tasa_crec_femenina.png")
# Población sindicada a serie de tiempo por situación
ppl_sitjur  %>% spread(key = "categoria", value = valor) -> ppl_situacion
# Serie de tiempo de población total
TPPtimeseries <- ts(ppl_situacion$total, frequency=12, start=c(1991,1))
# Serie de tiempo de población sindicada
SPPtimeseries <- ts(ppl_situacion$condenados, frequency=12, start=c(1991,1))
# Serie de tiempo de población condenada
CPPtimeseries <- ts(ppl_situacion$sindicados, frequency=12, start=c(1991,1))
# Ajustar a zoo, para poder hacer gráfica
Total <- as.zoo(diff(TPPtimeseries))
Sindicados <- as.zoo(diff(SPPtimeseries))
Condenados <- as.zoo(diff(CPPtimeseries))
# Gráficar crecimient de las tres
autoplot(merge(Total, Sindicados, Condenados), geom = "line")  + ylab("N° de personas") + xlab("Periodo") -> graf_var
graf_var
ggsave("variacion_intermensual.png")
# Descomponer variación intermensual
DeltaTPP <- decompose(Total)
# Asignar
tendencia <- as.zoo(DeltaTPP$trend)
aleatorio <- as.zoo(DeltaTPP$random)
estacional <- as.zoo(DeltaTPP$seasonal)
# Generar gráfica
autoplot(merge(tendencia,estacional, aleatorio), geom = "line") + ylab("N° de personas") + xlab("Periodo") -> graf_tendencia_tpp
graf_tendencia_tpp
ggsave("variacion_mensual_total_desc.png")
# Descomponer variación intermensual
DeltaSPP <- decompose(Sindicados)
# Asignar
tendencia <- as.zoo(DeltaSPP$trend)
aleatorio <- as.zoo(DeltaSPP$random)
estacional <- as.zoo(DeltaSPP$seasonal)
# Generar gráfica
autoplot(merge(tendencia,estacional, aleatorio), geom = "line") + ylab("N° de personas, sindicados") + xlab("Periodo") -> graf_tendencia_spp
# gráfica
graf_tendencia_spp
ggsave("variacion_mensual_sindicados_desc.png")
# Descomponer variación intermensual
DeltaCPP <- decompose(Condenados)
# Asignar
tendencia <- as.zoo(DeltaCPP$trend)
aleatorio <- as.zoo(DeltaCPP$random)
estacional <- as.zoo(DeltaCPP$seasonal)
# Generar gráfica
autoplot(merge(tendencia,estacional, aleatorio), geom = "line") + ylab("N° de personas, condenados") + xlab("Periodo") -> graf_tendencia_cpp
# gráfica
graf_tendencia_cpp
ggsave("variacion_mensual_condenados_desc.png")
ppl_sitjur %>% dplyr::filter(categoria == "total", !(is.na(valor))) -> ppl_total
ppl_total <- ppl_total$valor
ts_total <- ts(ppl_total, start = 1991, frequency = 12)
#plot(diff(diff(ts_total), lag = 12))
#acf2(diff(diff(ts_total), lag = 12), max.lag = 60, details = FALSE)
plot(acf(diff(diff(ts_total), lag = 12), lag.max = 60, plot = FALSE),main = " ")
#dev.copy(png,'AFC_var_pob_total_desesta.png')
#dev.off()
pacf_total <- plot(pacf(diff(diff(ts_total), lag = 12), lag.max = 60, plot = FALSE),main = " ")
#dev.copy(png,'PAFC_var_pob_total_desesta.png')
#dev.off()
## Crear variables
# Población carcelaria total
ppl_sitjur %>% dplyr::filter(categoria == "total", !(is.na(valor))) -> ppl_total
ppl_total <- ppl_total$valor
ts_total <- ts(ppl_total, start = 1991, frequency = 12)
# Sindicados
ppl_sitjur %>% dplyr::filter(categoria == "sindicados", !(is.na(valor))) -> ppl_sindi
ppl_sindi <- ppl_sindi$valor
ts_sindi <- ts(ppl_sindi, start = 1991, frequency = 12)
# Condenados
ppl_sitjur %>% dplyr::filter(categoria == "condenados", !(is.na(valor))) -> ppl_conde
ppl_conde <- ppl_conde$valor
ts_conde <- ts(ppl_conde, start = 1991, frequency = 12)
error = 2/sqrt(length(ppl_conde))
## Población total
# Calcular acf y pacf
acf_total <- as.data.frame(acf2(diff(diff(ts_total), lag = 12), max.lag = 60))
# Gráfica acf total
acf_total %>% ggplot() + geom_bar(aes(x = c(1:60), y = ACF), stat = "identity", fill = "steelblue") + scale_x_continuous(breaks = c(12,24,36,48,60)) + xlab("LAG") + ggtitle("ACF Población total") + ylim(c(-0.55,0.55)) + geom_hline(aes(yintercept = error), colour = "royalblue", linetype="dashed") + geom_hline(aes(yintercept = -error), colour = "royalblue", linetype="dashed") + theme_minimal()-> graf_acf_total
# Gráfica pacf total
acf_total %>% ggplot() + geom_bar(aes(x = c(1:60), y = PACF), stat = "identity", fill = "steelblue") + scale_x_continuous(breaks = c(12,24,36,48,60)) + xlab("LAG") + ggtitle("PACF Población total") + ylim(c(-0.55,0.55)) + geom_hline(aes(yintercept = error), colour = "royalblue", linetype="dashed") + geom_hline(aes(yintercept = -error), colour = "royalblue", linetype="dashed") + theme_minimal() -> graf_pacf_total
## Población sindicada
# Calcular acf y pacf
acf_sindi <- as.data.frame(acf2(diff(diff(ts_sindi), lag = 12), max.lag = 60))
# Gráfica acf sindicados
acf_sindi %>% ggplot() + geom_bar(aes(x = c(1:60), y = ACF), stat = "identity", fill = "steelblue1") + scale_x_continuous(breaks = c(12,24,36,48,60)) + xlab("LAG") + ggtitle("ACF Población sindicada") + ylim(c(-0.55,0.55)) + geom_hline(aes(yintercept = error), colour = "royalblue", linetype="dashed") + geom_hline(aes(yintercept = -error), colour = "royalblue", linetype="dashed") + theme_minimal() -> graf_acf_sindi
# Gráfica pacf sindicados
acf_sindi %>% ggplot() + geom_bar(aes(x = c(1:60), y = PACF), stat = "identity", fill = "steelblue1") + scale_x_continuous(breaks = c(12,24,36,48,60)) + xlab("LAG") + ggtitle("PACF Población sindicada") + ylim(c(-0.55,0.55)) + geom_hline(aes(yintercept = error), colour = "royalblue", linetype="dashed") + geom_hline(aes(yintercept = -error), colour = "royalblue", linetype="dashed") + theme_minimal() -> graf_pacf_sindi
## Población condenada
# Calcular acf y pacf
acf_conde <- as.data.frame(acf2(diff(diff(ts_conde), lag = 12), max.lag = 60))
# Gráfica acf condenados
acf_conde %>% ggplot() + geom_bar(aes(x = c(1:60), y = ACF), stat = "identity", fill = "steelblue2") + scale_x_continuous(breaks = c(12,24,36,48,60)) + xlab("LAG") + ggtitle("ACF Población condenada") + ylim(c(-0.55,0.55)) + geom_hline(aes(yintercept = error), colour = "royalblue", linetype="dashed") + geom_hline(aes(yintercept = -error), colour = "royalblue", linetype="dashed") + theme_minimal() -> graf_acf_conde
# Gráfica pacf condenados
acf_conde %>% ggplot() + geom_bar(aes(x = c(1:60), y = PACF), stat = "identity", fill = "steelblue2") + scale_x_continuous(breaks = c(12,24,36,48,60)) + xlab("LAG") + ggtitle("PACF Población condenada") + ylim(c(-0.55,0.55)) + geom_hline(aes(yintercept = error), colour = "royalblue", linetype="dashed") + geom_hline(aes(yintercept = -error), colour = "royalblue", linetype="dashed") + theme_minimal() -> graf_pacf_conde
#png(file = 'ACF_var_pob.png', height = 750, width = 500, res = 85)
ACF_var_pob <- grid.arrange(graf_acf_total, graf_pacf_total,graf_acf_sindi, graf_pacf_sindi,graf_acf_conde, graf_pacf_conde, ncol = 2)
ACF_var_pob
#dev.copy(png,'ACF_var_pob')
#dev.off()
arima_total <- sarima(ts_total,1,1,1,0,0,1, S = 12, details = FALSE)
sarima_total_2 <- sarima(ts_total,1,1,1,0,0,2, S = 12, details = FALSE)
forecast <- sarima.for(ts_total,n.ahead = 36, 1,1,1,0,0,2, S = 12)
ppl_sitjur %>% dplyr::filter(categoria == "sindicados", !(is.na(valor))) -> ppl_sin
ppl_sin <- ppl_sin$valor
ts_sin <- ts(ppl_sin, start = 1991, frequency = 12)
# plot(diff(diff(ts_total), lag = 12))
# acf2(diff(diff(ts_total), lag = 12), max.lag = 60, details = FALSE)
plot (acf(diff(diff(ts_sin), lag = 12), lag.max = 60, plot = FALSE),main = "AFC Variación de la población sindicada desestacionalizado")
plot(pacf(diff(diff(ts_sin), lag = 12), lag.max = 60, plot = FALSE),main = "PAFC Variación de la población sindicada desestacionalizado")
forecast <- sarima.for(ts_sin,n.ahead = 36, 1,1,1,0,0,1, S = 12)
ppl_sitjur %>% dplyr::filter(categoria == "condenados", !(is.na(valor))) -> ppl_con
ppl_con <- ppl_con$valor
ts_con <- ts(ppl_con, start = 1991, frequency = 12)
# plot(diff(diff(ts_total), lag = 12))
# acf2(diff(diff(ts_total), lag = 12), max.lag = 60, details = FALSE)
acf <- plot (acf(diff(diff(ts_con), lag = 12), lag.max = 60, plot = FALSE),main = "AFC Variación de la población condenada desestacionalizado")
plot(pacf(diff(diff(ts_con), lag = 12), lag.max = 60, plot = FALSE),main = "PAFC acf Variación de la población condenada desestacionalizado")
forectast <- sarima.for(ts_con,n.ahead = 36, 1,1,1,0,0,1, S = 12)
ts_sincon <- cbind (diff(ts_sin), diff(ts_con))
VARselect(ts_sincon, lag.max=9, type="const")
ts_sincon_mod <- VAR(ts_sincon,p = 1)
forecast_var <- predict(ts_sincon_mod, n.ahead = 60)
ts_sincon_mod
forecast_var
# Cite packages
if(nchar(system.file(package="astsa"))) citation("astsa")
### Total 111002
png(file = 'Arima_total_111002.png', height = 750, width = 500, res = 85)
arima_total_1 <- sarima(ts_total,1,1,1,0,0,2, S = 12, details = FALSE)
dev.off()
### Total 111001
png(file = 'Arima_total_111001.png', height = 750, width = 500, res = 85)
arima_total_2 <- sarima(ts_total,1,1,1,0,0,1, S = 12, details = FALSE)
dev.off()
auto.arima(ts_total)
### Total Auto Arima
png(file = 'Arima_total_321002.png', height = 750, width = 500, res = 85)
arima_total_3 <- sarima(ts_total,3,2,1,0,0,2, S = 12, details = FALSE)
dev.off()
auto.arima(ts_total, ic = "aic")
### Total 121002
png(file = 'Arima_total_121002.png', height = 750, width = 500, res = 85)
arima_total_4 <- sarima(ts_total,1,2,1,0,0,2, S = 12, details = FALSE)
dev.off()
Indicadores <- matrix(c(arima_total_1$AIC,arima_total_1$BIC,arima_total_2$AIC,arima_total_2$BIC,arima_total_3$AIC,arima_total_3$BIC,arima_total_4$AIC,arima_total_4$BIC),ncol = 2)
AIC_total <- AIC(arima_total_1$fit,arima_total_2$fit, arima_total_3$fit,arima_total_4$fit)
BIC_total <- BIC(arima_total_1$fit,arima_total_2$fit, arima_total_3$fit,arima_total_4$fit)
Indicadores_df <- cbind(c("(1,1,1,0,0,2)","(1,1,1,0,0,1)","(3,2,1,0,0,2)","(1,2,1,0,0,2)"),round(AIC_total$AIC,2), round(BIC_total$BIC,2))
colnames(Indicadores_df) <- c("ORDEN","AIC","BIC")
#xtable(Indicadores_df)
#xtable(arima_total_4$ttable)
#xtable(arima_total_4$ttable, label = "parámetros_121002", caption = "Parámetros del modelo (1,2,1,0,0,2)")
### sindicado 111001
png(file = 'Arima_sindi_11101.png', height = 750, width = 500, res = 85)
arima_sindi_1 <- sarima(ts_sindi,1,1,1,0,0,1, S = 12, details = FALSE)
dev.off()
### sindicado 211001
png(file = 'Arima_sindi_211001.png', height = 750, width = 500, res = 85)
arima_sindi_2 <- sarima(ts_sindi,2,1,1,0,0,1, S = 12, details = FALSE)
dev.off()
auto.arima(ts_sindi, ic = "aic")
### sindicado Auto Arima
png(file = 'Arima_sindi_012001.png', height = 750, width = 500, res = 85)
arima_sindi_3 <- sarima(ts_sindi,0,1,2,0,0,1, S = 12, details = FALSE)
dev.off()
### Total 121002
png(file = 'Arima_sindi_011000.png', height = 750, width = 500, res = 85)
arima_sindi_4 <- sarima(ts_sindi,0,1,1,0,0,0, S = 12, details = FALSE)
dev.off()
AIC_sindi <- AIC(arima_sindi_1$fit,arima_sindi_2$fit, arima_sindi_3$fit,arima_sindi_4$fit)
BIC_sindi <- BIC(arima_sindi_1$fit,arima_sindi_2$fit, arima_sindi_3$fit,arima_sindi_4$fit)
Indicadores_df_sindi <- cbind(c("(1,1,1,0,0,1)","(2,1,1,0,0,1)","(0,1,1,0,0,1)","(0,1,1,0,0,0)"),round(AIC_sindi$AIC,2), round(BIC_sindi$BIC,2))
colnames(Indicadores_df_sindi) <- c("ORDEN","AIC","BIC")
xtable(Indicadores_df_sindi)
#xtable(arima_total_4$ttable)
xtable(arima_sindi_3$ttable, label = "parámetros_sindi_011001", caption = "Parámetros del modelo (0,1,1,0,0,1)")
### condenada 111001
png(file = 'Arima_conde_111001.png', height = 750, width = 500, res = 85)
arima_conde_1 <- sarima(ts_conde,1,1,1,0,0,1, S = 12, details = FALSE)
dev.off()
### condenado 211001
png(file = 'Arima_conde_211001.png', height = 750, width = 500, res = 85)
arima_conde_2 <- sarima(ts_conde,2,1,1,0,0,1, S = 12, details = FALSE)
dev.off()
auto.arima(ts_conde, ic = "aic")
### condenado Auto Arima
png(file = 'Arima_conde_012001.png', height = 750, width = 500, res = 85)
arima_conde_3 <- sarima(ts_conde,0,1,2,0,0,1, S = 12, details = FALSE)
dev.off()
### Total 121002
png(file = 'Arima_conde_011000.png', height = 750, width = 500, res = 85)
arima_conde_4 <- sarima(ts_conde,0,1,1,0,0,0, S = 12, details = FALSE)
dev.off()
AIC_conde <- AIC(arima_conde_1$fit,arima_conde_2$fit, arima_conde_3$fit,arima_conde_4$fit)
BIC_conde <- BIC(arima_conde_1$fit,arima_conde_2$fit, arima_conde_3$fit,arima_conde_4$fit)
Indicadores_df_conde <- cbind(c("(1,1,1,0,0,1)","(2,1,1,0,0,1)","(0,1,1,0,0,1)","(0,1,1,0,0,0)"),round(AIC_conde$AIC,2), round(BIC_conde$BIC,2))
colnames(Indicadores_df_conde) <- c("ORDEN","AIC","BIC")
xtable(Indicadores_df_conde)
#xtable(arima_total_4$ttable)
xtable(arima_conde_1$ttable, label = "parámetros_conde_111001", caption = "Parámetros del modelo (1,1,1,0,0,1)")
# Proyección
forecast <- sarima.for(ts_total,n.ahead = 36, 1,2,1,0,0,2, S = 12)
# data frame
forecast_frame <- data.frame(Proyección=as.matrix(forecast$pred),Error=as.matrix(forecast$se), date=as.Date(as.yearmon(time(forecast$pred)))) %>% mutate(lim_sup = Proyección+Error, lim_inf = Proyección - Error)
#data histórica
hist_frame <- data.frame(Historico=as.matrix(ts_total), date=as.Date(as.yearmon(time(ts_total))))
# ggplot
ggplot() + geom_ribbon(data = forecast_frame, aes(x = date, ymin = Proyección - 2*Error, ymax = Proyección+2*Error, fill = "2 sd"  ), fill = "grey90")  + geom_ribbon(data = forecast_frame, aes(x = date, ymin = Proyección -Error, ymax = Proyección+Error,fill = "1 sd"  ), fill = "grey80") + geom_line(data = forecast_frame, aes(x = date, y = Proyección, colour = "Proyección")) + geom_line(data = hist_frame, aes(x = date, y = Historico, colour = "Histórico")) + xlab("Población carcelaria total") + theme_minimal() -> graf_pry_total_4
graf_pry_total_4
ggsave("graf_pry_total_4.png")
# Proyección
forecast <- sarima.for(ts_sindi,n.ahead = 36, 0,1,1,0,0,1, S = 12)
# data frame
forecast_frame <- data.frame(Proyección=as.matrix(forecast$pred),Error=as.matrix(forecast$se), date=as.Date(as.yearmon(time(forecast$pred)))) %>% mutate(lim_sup = Proyección+Error, lim_inf = Proyección - Error)
#data histórica
hist_frame <- data.frame(Historico=as.matrix(ts_sindi), date=as.Date(as.yearmon(time(ts_sindi))))
# ggplot
ggplot() + geom_ribbon(data = forecast_frame, aes(x = date, ymin = Proyección - 2*Error, ymax = Proyección+2*Error, fill = "2 sd"  ), fill = "grey90")  + geom_ribbon(data = forecast_frame, aes(x = date, ymin = Proyección -Error, ymax = Proyección+Error,fill = "1 sd"  ), fill = "grey80") + geom_line(data = forecast_frame, aes(x = date, y = Proyección, colour = "Proyección")) + geom_line(data = hist_frame, aes(x = date, y = Historico, colour = "Histórico")) + xlab("Población carcelaria sindicada") + theme_minimal() -> graf_pry_total_3
graf_pry_total_3
ggsave("graf_pry_sindi_3.png")
# Proyección
forecast <- sarima.for(ts_conde,n.ahead = 36, 1,1,1,0,0,1, S = 12)
# data frame
forecast_frame <- data.frame(Proyección=as.matrix(forecast$pred),Error=as.matrix(forecast$se), date=as.Date(as.yearmon(time(forecast$pred)))) %>% mutate(lim_sup = Proyección+Error, lim_inf = Proyección - Error)
#data histórica
hist_frame <- data.frame(Historico=as.matrix(ts_conde), date=as.Date(as.yearmon(time(ts_conde))))
# ggplot
ggplot() + geom_ribbon(data = forecast_frame, aes(x = date, ymin = Proyección - 2*Error, ymax = Proyección+2*Error, fill = "2 sd"  ), fill = "grey90")  + geom_ribbon(data = forecast_frame, aes(x = date, ymin = Proyección -Error, ymax = Proyección+Error,fill = "1 sd"  ), fill = "grey80") + geom_line(data = forecast_frame, aes(x = date, y = Proyección, colour = "Proyección")) + geom_line(data = hist_frame, aes(x = date, y = Historico, colour = "Histórico")) + xlab("Población carcelaria condenada") + theme_minimal() -> graf_pry_conde_1
graf_pry_conde_1
ggsave("graf_pry_conde_1.png")
url <- "https://www.dropbox.com/s/94oblxtlc8anlk1/PRY_POB_NAL_DANE_EDAD.csv?dl=1"
destfile <- "POB_NAL_DAN_EDAD.csv"
curl_download(url, destfile)
pob_nal_dane_edad = read.csv("POB_NAL_DAN_EDAD.csv",header = TRUE,sep = ",",stringsAsFactors=FALSE)
pob_nal_dane_edad %<>% gather(Rango_edad, Poblacion, -Año, -Grupos.de.edad) %>% spread(Grupos.de.edad, Poblacion)
pob_nal_dane_edad %<>% dplyr::filter(Año>1990)
pob_nal_dane_edad$Rango_edad<- gsub("X","",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("\\.","-",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("0-4","00-04",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("400-044","40-44",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("5-9","05-09",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad %>% ggplot(aes(x=Año, y = Total/1000000, fill = Rango_edad)) + geom_bar(stat="identity", width = 1) + theme_minimal() + ylab("Proyecciones de población nacional (MM)") + scale_fill_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(17)) + theme(legend.position="none") -> pob_total_edad_stack
pob_nal_dane_edad %>% ggplot(aes(x=Año, y = Total/1000000, colour = Rango_edad)) + geom_line() + theme_minimal() + ylab("Proyecciones de población nacional (MM)") + scale_colour_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(17)) + theme(legend.position="none") -> pob_total_edad
### Crear columna de participación
pob_nal_dane_edad %<>% group_by(Año) %>% summarise(Totales_año = sum(Total)) %>% right_join(pob_nal_dane_edad, by = NULL) %>% mutate (Participacion= Total/Totales_año*100)
pob_nal_dane_edad %>% ggplot(aes(x=Año, y = Participacion, fill = Rango_edad)) + geom_bar(stat="identity", width = 1) + theme_minimal() + ylab("Proyecciones de población nacional (%)") + scale_fill_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(17)) -> pob_total_edad_stack_part
pob_nal_dane_edad %>% ggplot(aes(x=Año, y = Participacion, colour = Rango_edad)) + geom_line() + theme_minimal() + ylab("Proyecciones de población nacional (%)") + scale_colour_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(17)) -> pob_total_edad_part
# Generar gráfica
#png(file = 'POB_NAL_EDAD.png', height = 850, width = 600, res = 85)
POB_NAL_EDAD <- grid.arrange(pob_total_edad_stack, pob_total_edad_stack_part,pob_total_edad, pob_total_edad_part, ncol = 2)
POB_NAL_EDAD
#dev.off()
pob_nal_dane_edad = read.csv("POB_NAL_DAN_EDAD.csv",header = TRUE,sep = ",",stringsAsFactors=FALSE)
pob_nal_dane_edad = read.csv("POB_NAL_DAN_EDAD.csv",header = TRUE,sep = ",",stringsAsFactors=FALSE)
pob_nal_dane_edad %<>% gather(Rango_edad, Poblacion, -Año, -Grupos.de.edad) %>% spread(Grupos.de.edad, Poblacion)
pob_nal_dane_edad %<>% dplyr::filter(Año>1990)
pob_nal_dane_edad$Rango_edad<- gsub("X","",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("\\.","-",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("0-4","00-04",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("400-044","40-44",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad$Rango_edad<- gsub("5-9","05-09",pob_nal_dane_edad$Rango_edad)
pob_nal_dane_edad %>% dplyr::select(Año, Rango_edad, Total) %>% tidyr::spread(Rango_edad, Total) -> pob_dane_edad
ppl_sitjur %>% dplyr::filter(categoria =="total", mes == 5, !is.na(valor)) %>% dplyr::select(valor, anio) -> pob_inpec_total
dim[pob_inpec_total]
dim(pob_inpec_total)
dim(pob_inpec_total)[1]
registros <- dim(pob_inpec_total)[1]
View(pob_dane_edad)
View(pob_dane_edad)
sum(pob_dane_edad[,2:4])
apply()
?apply()
?ssapply()
?ssapply()
?sapply()
apply(pob_dane_edad[,2:4],1,sum)
apply(pob_dane_edad[,2:4],1,sum)
registros <- dim(pob_inpec_total)[1]
apply(pob_dane_edad[,2:4],1,sum)
ppl_sitjur %>% dplyr::filter(categoria =="total", mes == 5, !is.na(valor)) %>% dplyr::select(valor, anio) -> pob_inpec_total
View(pob_inpec_total)
apply(pob_dane_edad[,2:4],1,sum)
apply(pob_dane_edad[,2:4],1,sum)
dim(pob_dane_edad)
apply(pob_dane_edad[,15:18],1,sum)
apply(pob_dane_edad[,16:18],1,sum)
"2-4" <-apply(pob_dane_edad[,2:4],1,sum)
"0-14" <-apply(pob_dane_edad[,2:4],1,sum)
"60 y más" <- apply(pob_dane_edad[,16:18],1,sum)
cbind("0-14","60 y más")
cbind(0-14,60 y más)
Menor_14 <-apply(pob_dane_edad[,2:4],1,sum)
Mayor_60 <- apply(pob_dane_edad[,16:18],1,sum)
cbind(Menor_14,Mayor_60)
cbind(Menor_14,pob_dane_edad[,5:15],Mayor_60)
Regresores <- cbind(Menor_14,pob_dane_edad[,5:15],Mayor_60)
View(Regresores)
ppl_sitjur %>% dplyr::filter(categoria =="total", mes == 5, !is.na(valor)) %>% dplyr::select(valor, anio) -> pob_inpec_total
View(pob_inpec_total)
Regresores <- cbind(Menor_14,pob_dane_edad[,5:15],Mayor_60)
Pob_total <- apply(Regresores,1,sum)
Pob_total <- apply(Regresores,1,sum)
Pob_total
View(pob_dane_edad)
tasa_encarcelamiento <- pob_inpect_total/Pob_total[1:registros]
tasa_encarcelamiento <- pob_inpec_total/Pob_total[1:registros]
View(tasa_encarcelamiento)
View(tasa_encarcelamiento)
tasa_encarcelamiento <- pob_inpec_total[1,]/Pob_total[1:registros]
View(tasa_encarcelamiento)
tasa_encarcelamiento <- pob_inpec_total[,1]/Pob_total[1:registros]
tasa_encarcelamiento <- pob_inpec_total[,1]/Pob_total[1:registros]
tasa_encarcelamiento
tasa_encar <- pob_inpec_total[,1]/Pob_total[1:registros]
tasa_encar
# Guardar modelo de regresión
tasa_regresores <- cbind(tasa_encar,Regresores[1:registros,])
View(tasa_regresores)
# Save
write.table(tasa_regresores,"tasa_regresores.csv",sep=",",row.names = "FALSE")
# Guardar modelo de regresión
tasa_regresores <- cbind(tasa_encar,Regresores[1:registros,])
# Save
write.table(tasa_regresores,"tasa_regresores.csv",sep=",",row.names = "FALSE")
# Save
write.table(tasa_regresores,"tasa_regresores.csv",sep=",",row.names = "FALSE")
# Save
write.table(tasa_regresores,"tasa_regresores.csv",sep=",")
# Save
write.table(tasa_regresores,"tasa_regresores.csv",sep=",",row.names = FALSE)
library("rcmdr")
library("Rcmdr")
View(tasa_regresores)
library("rms") #regression
installed.packages("rms")
install.packages("rms")
tasa_regresores
reg <- lrm( tasa_regresores$tasa_encar ∼ X15.19)
reg <- lrm( tasa_regresores$tasa_encar ~ X15.19)
library("rms") #regression
reg <- lrm( tasa_regresores$tasa_encar ~ X15.19)
reg <- lrm( tasa_regresores$tasa_encar ~ tasa_regresores$X15.19)
reg <- lrm( tasa_regresores$tasa_encar ~ tasa_regresores$X15.19 + tasa_regresores$X20.24)
reg <- lrm( tasa_regresores$tasa_encar ~ tasa_regresores$X15.19 + tasa_regresores$X20.24)
reg <- lrm( tasa_regresores$tasa_encar ~ tasa_regresores$X15.19 + tasa_regresores$X20.24 + tasa_regresores$X24.28)
tasa_regresores
reg <- lrm( tasa_regresores$tasa_encar ~ tasa_regresores$X15.19 + tasa_regresores$X20.24 + tasa_regresores$X25.29)
reg <- lrm(tasa_regresores$tasa_encar ~ tasa_regresores$X15.19 + tasa_regresores$X20.24 + tasa_regresores$X25.29)
reg <- lrm(tasa_encar ~ X15.19 + X20.24 + X25.29, data = tasa_regresores)
reg <- lr(tasa_encar ~ X15.19 + X20.24 + X25.29, data = tasa_regresores)
reg <- lrm(tasa_encar ~ -1 X15.19 + X20.24 + X25.29, data = tasa_regresores)
reg <- lrm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29, data = tasa_regresores)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29, data = tasa_regresores)
reg <- lm(tasa_encar ~  X15.19 + X20.24 + X25.29, data = tasa_regresores)
ddist ← datadist(tasa_regersores)
ddist <- datadist(tasa_regersores)
ddist <- datadist(tasa_regresores)
options(datadst = "ddist")
reg <- lrm(tasa_regresores$tasa_encar ~ tasa_regresores$X15.19 + tasa_regresores$X20.24 + tasa_regresores$X25.29)
reg <- lrm(tasa_encar ~ X15.19 + X20.24 + X25.29)
reg <- lrm(tasa_encar ~ X15.19 + X20.24 + X25.29, data = tasa_regresores)
reg <- lrm(tasa_encar ~ +1 + X15.19 + X20.24 + X25.29, data = tasa_regresores)
reg <- lrm(tasa_encar ~ 1 + X15.19 + X20.24 + X25.29, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29 +  X30.34 + X35.38 + X40.44 , data = tasa_regresores)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29 +  X30.34 + X35.39 + X40.44 , data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~  X15.19 + X20.24 + X25.29 +  X30.34 + X35.39 + X40.44 , data = tasa_regresores)
summary(reg)
names(tasa_regresores)
reg <- lm(tasa_encar ~  Menor_14 + X15.19 + X20.24 + X25.29 +  X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59 + Mayor_60, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~  Menor_14 + X15.19 + X20.24 + X25.29 +  X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59 + Mayor_60, data = tasa_regresores)
summary(reg)
step(reg,direction="both")
?step
step(reg,direction="forward")
step(reg,direction="backward")
reg <- lm(tasa_encar ~  -1 + Menor_14 + X15.19 + X20.24 + X25.29 +  X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59 + Mayor_60, data = tasa_regresores)
summary(reg)
step(reg,direction="backward")
ddist <- datadist(tasa_regresores)
options(datadst = "ddist")
reg <- lm(tasa_encar ~  -1 + X15.19 + X20.24 + X25.29 +  X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59 + Mayor_60, data = tasa_regresores)
summary(reg)
step(reg,direction="backward")
reg <- lm(tasa_encar ~  -1 + X15.19 + X20.24 + X25.29 +  X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~  -1 + X15.19 + X20.24 + X25.29 + X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29 + X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29 + X30.34 + X35.39 + X40.44 + X45.49 + X50.54 +  X55.59, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29 + X30.34 + X35.39, data = tasa_regresores)
summary(reg)
View(tasa_regresores)
# Guardar modelo de regresión
tasa_regresores <- cbind(pob_inpec_total[,1],Regresores[1:registros,])
View(tasa_regresores)
# Guardar modelo de regresión
tasa_regresores <- cbind(tasa_encar = pob_inpec_total[,1],Regresores[1:registros,])
View(tasa_regresores)
reg <- lm(tasa_encar ~ -1 Men + X15.19 + X20.24 + X25.29 + X30.34 + X35.39, data = tasa_regresores)
View(tasa_regresores)
reg <- lm(tasa_encar ~ -1 + X15.19 + X20.24 + X25.29 + X30.34 + X35.39, data = tasa_regresores)
View(tasa_regresores)
# Guardar modelo de regresión
tasa_regresores <- cbind(tasa_encar = pob_inpec_total[,1],Regresores[1:registros,])
# Salvar
write.table(tasa_regresores,"tasa_regresores.csv",sep=",",row.names = FALSE)
tasa_regresores <- read.table("tasa_regresores.csv")
# Salvar
write.table(tasa_regresores,"tasa_regresores.csv",sep=",",row.names = FALSE)
tasa_regresores <- read.table("tasa_regresores.csv")
tasa_regresores <- read.table("tasa_regresores.csv", sep = ",")
View(tasa_regresores)
tasa_regresores <- read.table("tasa_regresores.csv", sep = ",", col.names = TRUE)
tasa_regresores <- read.table("tasa_regresores.csv", sep = ",", col.names = TRUE)
tasa_regresores <- read.table("tasa_regresores.csv", sep = ",")
tasa_regresores <- read.table("tasa_regresores.csv", sep = ",")
tasa_regresores
View(tasa_regresores)
tasa_regresores <- read.table("tasa_regresores.csv", sep = ",", header = TRUE)
View(tasa_regresores)
ddist <- datadist(tasa_regresores)
options(datadst = "ddist")
reg <- lm(tasa_encar ~ -1 + X20.24  + X20.24 + X25.29 + X30.34 + X35.39, data = tasa_regresores)
summary(reg)
View(tasa_regresores)
reg <- lm(tasa_encar ~ X20.24  + X20.24 + X25.29 + X30.34 + X35.39, data = tasa_regresores)
summary(reg)
View(tasas_encarcelamiento)
View(tasas_encarcelamiento)
View(tasa_regresores)
reg <- lm(tasa_encar ~ X20.24  + X20.24 + X25.29 + X30.34 + X35.39 + X40.44 + X45.49 + X50.54 + X55.59 + Mayor_60, data = tasa_regresores)
summary(reg)
reg <- lm(tasa_encar ~-1 + X15.19 + X20.24  + X20.24 + X25.29 + X30.34 + X35.39 + X40.44 + X45.49 + X50.54 + X55.59 + Mayor_60, data = tasa_regresores)
reg <- lm(tasa_encar ~-1 + X15.19 + X20.24  + X20.24 + X25.29 + X30.34 + X35.39 + X40.44 + X45.49 + X50.54 + X55.59 + Mayor_60, data = tasa_regresores)
summary(reg)
